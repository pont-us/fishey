/*** application.h ***/
/* A standard framework for Toolbox/OSLib applications
 * (c) Paul Field 1995
 * v1.00 - 23/11/1995
 * v1.01 - 24/5/1996
 *
 * This is a fairly experimental idea. Basically the application system
 * implements main() and sets up everything that a standard Toolbox application
 * needs:
 *   initialises the toolbox
 *   initialises the exception system
 *   initialises the event handling system
 *   sets up handlers for:
 *     the Wimp Quit message
 *     an application Quit event (e.g. generated by Quit on the icon bar menu)
 *     toolbox errors
 *   starts polling
 *
 * All you need to do is define an application variable called
 * 'this_application' as declared below and write an initialise() function
 * (and maybe a quit() function) to set up application-specific details.
 *
 * Note that you may throw exceptions in your event handlers and the application
 * framework will catch them, report them and then continue polling.
 *
 * This header should only be included once in your program (you'll get a link error
 * about multiply-defined symbols if you don't) and your program should not have
 * a main() function.
 *
 * NOTE: application initialises nevent, nevent_toolbox and nevent_message.
 * It DOES NOT initialise nevent_wimp, because it doesn't need it and programs don't
 * want to link in the nevent_wimp code unless it's used.
 */

#include "bool.h"


/* Values that define an application */
typedef struct application_str
 { /* These parameters are as passed to toolbox_initialise() */
   const char* directory_name;
   unsigned    earliest_wimp_version;
   const int*  toolbox_actions;
   const int*  wimp_messages;

   /* Value passes to nevent_toolbox_initialise() */
   unsigned hash_table_size;

   /* Functions to initialise and quit your application */
   /* 'quit' may be NULL. If there is a quit function it should return
    * TRUE if the application should really quit and FALSE if the quit process
    * should be aborted and the application should continue to run.
    */
   void       (*initialise)(int argc, char* argv[]);
   bool       (*quit)(void);                          /* may be NULL */
 }application;



/* This is the Toolbox action code used to indicate the application should quit */
/* (is the same as action_QUIT_QUIT, generated by toolbox quit objects) */
enum { action_QUIT = 0x82a91 };



/* This is a declaration of the variable you must define */
extern application this_application;



/* Force linking of the application system when this header is included */
#ifndef application_internal
extern int main(int, char**);
extern int (* const application_force_link)(int, char**);
int (* const application_force_link)(int, char**) = main;
#endif
